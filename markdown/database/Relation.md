## 관계 (Relationship)

관계(Relationship)을 사전적으로 정의하면 상호 연관성이 있는 상태

> 데이터 모델에 대입하여 정의해 보면, "엔터티의 인스턴스 사이의 논리적인 연관성으로서 존재의 형태로서나 행위로서 서로에게 연관성이 부여된 상태"

관계는 엔터티와 엔터티 간 연관성을 표현하기 때문에 엔터티의 정의에 따라 영향을 받기도 하고, 송성 정의 및 관계 정의에 따라서 다양하게 변할 수 있다.

<br>

### 관계의 패어링

> 관계는 엔터티 안에 인스턴스가 개별적으로 관계를 가지는 것(패어링)

이것의 집합을 관계로 표현한다.

개별 인스턴스가 각각 다른 종류의 관계를 가지고 있다면 두 엔터티 사이에 두 개 이상의 관계가 형성될 수 있다.

각각의 엔터티의 인스턴스들은 자신이 관련된 인스턴스들과 관계의 어커런스로 참여하는 형태를 관계 패어링(Relationship Paring)이라 한다.

엔터티는 인스턴스의 집합을 논리적으로 표현했다면 관계는 관계 패어링의 집합을 논리적으로 표현한 것

초기 ERD(Chen 모델)에서 관계는 속성을 가질 수 있었으나 최근 ERD에서는 관계를 위해 속성을 도출하지 않는다.

관계의 표현에는 이항 관계(Binary Relationship), 삼항 관계(Ternart Relationship), n항 관계가 존재할 수 있으나 실제에 있어서 삼항 관계 이상은 잘 나타나지 않는다.

<br>

### 관계의 분류

> 관계가 존재에 의한 관계와 행위에 의한 관계로 구분될 수 있는 것은 관계를 연결함에 있어 어떤 목적으로 연결되었느냐에 따라 분류하기 때문이다.

존재의 형태에 의해 관계 형성되거나 행위(에 따른 이벤트 발생)에 의해 관계 형성

> UML(Undified Modeling Language)에는 클래스 다이어그램의 관계 중 연관(Association) 관계와 의존(Dependency) 관계가 있다.

연관 관계는 항상 이용하는 관계로 존재적 관계에 해당

의존 관계는 상대방 클래스의 행위에 의해 관계가 형성될 때 구분하여 표현

즉, ERD에서는 존재적 관계와 행위에 의한관계를 구분하지 않고 표현했다면 클래스 다이어 그램에서는 이것을 구분하여 연관 관계와 의존 관계로 표현

연관 관계는 표현 방법이 실선으로 표현되고 소스코드에서 멤버변수로 선언하여 사용

의존 관계는 점선으로 표현되고 행위를 나타내는 코드인 Operation(Method)에서 파라미터 등으로 이용 가능

<br>

### 관계의 표기법

관계에서는 표기법이 상당히 목잡하고 여러 가지 의미를 가지고 있다.
- 관계명(Membership) : 관계의 이름
- 관계차수(Cardinality) : 1:1, 1:m, m:n
- 관계선택사용(Optionality) : 필수관계, 선택관계

<br>

#### 관계명(Membership)

관계명은 엔터티가 관계에 참여하는 형태를 지칭

각 관계는 두 개의 관계명을 가지고 있고 각각의 관계명에 의해 두 가지 관점으로 표현될 수 있다.

엔터티에서 관계가 시작되는 편을 관계시작점(The Beginning), 받는 편을 관계끝점(The End)라 부른다.

관계 시작점과 끝점 모두 관계이름을 가져야 하며 참여자의 관점에 따라 관계 이름이 능동적(Active)이거나 수동적(Passive)으로 명명된다.

관계명은 다음과 같은 명명규칙에 따라 작성해야 한다.

- 애매한 동사를 피한다.
  
    구체적이지 않은 경우 어떤 행위가 있는지 또는 두 참여자간 어떤 상태가 존재하는지 파악할 수 없다.
- 현재형으로 표현한다.

<br>

#### 관계차수(Defree / Cardinality)

두 개의 엔터티간 관계에서 참여자의 수를 표현하는 것을 관계차수(Cardinality)라 한다.

가장 일반적인 관계차수 표현방법은 1:m, 1:1, m:n

가장 중요한 고려사항은 한 개의 관계가 존재하느냐 아니면 두 개 이상의 멤버쉽이 존재하는지를 파악하는 것이 중요하다.

관계차수를 표시하는 방법은 여러 방법이 있지만 Crow's Foot 모델에서는 선을 이용하여 표현한다.

한개가 참여하는 경우 실선을 그대로 유지하고 다수(Many)가 참여하는 경우 까마귀발과 같은 모양으로 그린다.

m:n 관계로 표현된 데이터 모델은 이후에 두 개의 주식별자를 상속받은 관계 엔터티를 이용하여 3개의 엔터티로 구분하여 표현한다.

<br>

#### 관계선택사양(Optionality)

관계에 참여하는 엔터티가 항상함여하는지 아니면 참여할 수도 있는지를 나타내는 방법이 필수 참여(madatory Membership)와 선택 창며(Optional Membership)이다.

필수 참여는 참여하는 모든 참여자가 만드시 관계를 가지는, 타 엔터티의 참여자와 연결이 되어야 하는 관계이다.

서로 필수적인 관계는 아닌 선택적인 관계일 경우 선택 참여

선택참여된 항목은 물리속성에서 Foreign Key로 연결될 경우 null을 허용할 수 있는 항목이 된다.

만약 선택참여로 지정해야 할 관계를 필수참여로 잘못 지정하면 애플리케이션에서 데이터가 발생할 떄 반드시 한 개의 트랜잭션으로 제어해야 하는 제약사항이 방생

그러므로 설계단계에서 필수참여와 선택참여는 개발시점에 업무 로직과 직접적으로 관련된 부분이므로 반드시 고려되어야 한다.

선택참여관계는 ERD에서 관계를 나타내는 선에서 선택참여하는 엔터티 쪽을 원으로 표시하낟. 필수 참여는 아무런 표시를 하지 않는다.

만약 관계가 표시된 양쪽 엔터티에 모두 선택참여가 표시된다면, 죽 0:0(Zero to Zero)의 관계가 된다면 그 관계는 잘못될 확률이 많으므로 관계설정이 잘못되었는지를 검토해보아야 한다.

관계선택사양은 관계를 통한 상대방과의 업무적인 제약조건을 표현하는 것으로서 간단하면서 아주 중요한 표기범이다. 이것을 어떻게 설정했는지에 따라 참조무결성제약조건의 규칙이 바뀌게 되므로 주의 깊게 모델링을 해야 한다.

<br>

### 관계의 정의 및 읽는 방법

#### 관계 체크사항

두 개의 엔터티 사이에서 관계를 정의할 때 다음 사항을 체크해 보도록 한다.

- 두 개의 엔터티 사이에 관심있는 연관 규칙이 존재하는가?
- 두 개의 엔터티 사이에 정보의 조합이 발생되는가?
- 업무기술서, 장표에 관계 연결에 대한 규칙이 서술되어 있는가?
- 업무기술서, 장표에 관계 연결을 가능하게 하는 동사(Verb)가 있는가?

<br>

#### 관계 읽기

데이터 모델을 읽는 방법은 먼저 관계에 참여하는 기준 엔터리를 하나 또는 각(Each)으로 읽고 대상 엔터티의 개수(하나, 하나 이상)를 읽고 관계선택사양과 관계명을 읽도록 한다.

- 기준(Source) 엔터티를 한 개(One) 또는 각(Each)으로 읽는다.
- 대상(Target) 엔터티의 관계참여도 즉 개수(하나, 하나 이상)를 읽는다.
- 관계선택사양과 관계명을 읽는다.

<br>
<br>

#### Source

https://dataonair.or.kr/db-tech-reference/d-guide/sql/?pageid=5&mod=document&uid=328